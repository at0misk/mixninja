<div class="container" id="profContainer">
	<div class="buffer">
	</div>
	<div class="row">
			<div class="col-xs-12" id="profile">
				<div class="profilePicture">
					<img class='profilePicture' src='<%= @User.avatar.url   %>'></img>
				</div>
				<div class="profileInfo">
				<span class="userAlias"><%= @User.alias %></span>
				<span class="userName"><%= @User.first_name %> <%= @User.last_name %></span>
				<span class="userField"><%= @User.email %></span>
				<span class="userField">Location: <%= @User.location %></span>
				<span class="userField">"<%= @User.tagline %>"</span>
				</div>
			</div>
			<% if @User.id == current_user[:id] %>
			<% else %>
				<% if @Follows.exists?(user_id: current_user[:id]) %>
				<form action='/follows' method='post'>
				    <input type='hidden' name='authenticity_token' value='<%= form_authenticity_token %>'>
				    <input type='hidden' name='_method' value='delete'>
				    <input type='hidden' name='follow[user_id]' value='<%= current_user[:id] %>'>
				    <input type='hidden' name='follow[follow_id]' value='<%= @User.id %>'>
				    <input type="submit" value="Unfollow">
				</form>
				<% else %>
				<form action='/follows' method='post'>
				    <input type='hidden' name='authenticity_token' value='<%= form_authenticity_token %>'>
				    <input type='hidden' name='follow[user_id]' value='<%= current_user[:id] %>'>
				    <input type='hidden' name='follow[follow_id]' value='<%= @User.id %>'>
				    <input type="submit" value="Follow">
				</form>
				<% end %>
			<% end %>
	</div>
	<div class="row">
			<% @User.tracks.each do |t| %>	
			<!-- Modal -->
			<% if current_user %>
			<div class="modal fade" id="deleteModal<%= t.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h4 class="modal-title" id="myModalLabel">Delete <%= t.title %>?</h4>
			      </div>
			      <div class="modal-body">
			      		<form action='/tracks' method='post'>
						    <input type='hidden' name='authenticity_token' value='<%= form_authenticity_token %>'>
						    <input type='hidden' name='_method' value='delete'>
						    <input type='hidden' name='id' value='<%= t.id %>'>
						    <input type="submit" value="Delete">
						</form>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
			        </form>
			      </div>
			    </div>
			  </div>
			</div>
			<% end %>
			<!-- End Modal -->
				<div class="col-xs-12">	
				<div class="track">			
						<h1><a href="/tracks/<%= t.id %>"><%= t.title %></a></h1>
							<h3><%= t.desc %></h3>
							<div id="waveform<%= t.id %>"></div>
							<div class="Pcontrol">
							 <button class="btn btn-custom" onclick="wavesurfer<%= t.id %>.playPause()">
							 	<span id="pIcon<%= t.id %>"><i class="glyphicon glyphicon-play"></i></span>
			    				<span id="pPlay<%= t.id %>">Play</span>
			  				</button>
			  				<% if current_user[:id] == @User.id %>
							<button type="button" class="btn btn-custom " data-toggle="modal" data-target="#deleteModal<%= t.id %>">
					  			Delete
							</button>
							<% end %>
						</div>
					<script type="text/javascript">
						var wavesurfer<%= t.id %> = WaveSurfer.create({
							barWidth: 1,
							fillParent: true,
							progressColor: 'blue',
							waveColor: 'purple',
							container: '#waveform<%= t.id %>',
							backend: 'MediaElement',
							scrollParent: true
						});
						wavesurfer<%= t.id %>.load('<%= t.avatar.url %>');
						$(document).ready(function(){
							wavesurfer<%= t.id %>.on('audioprocess', function(){
								var current = wavesurfer<%= t.id %>.getCurrentTime()
								var d = moment.duration(current, 'seconds')
								var hours = ("0" + d.hours()).slice(-2);
								var minutes = ("0" + d.minutes()).slice(-2);
								var seconds = ("0" + d.seconds()).slice(-2);
								var milli = ("0" + Math.floor(d.milliseconds())).slice(-2);
								$('#time<%= t.id %>').html( hours + ": " + minutes + ": " + seconds + ": " + milli);
							});
							$('#pPlay<%= t.id %>').click(function(){
								$('#pIcon<%= t.id %>').find('i').toggleClass("glyphicon-play").toggleClass("glyphicon-pause");
								$(this).text(function(i, v){
									return v === 'Play' ? 'Pause' : 'Play';
								});
							});
						});
					</script>
					<h3>Playback: <span id="time<%= t.id %>">00: 00: 00: 00</span></h3>
					</script>
				</div>
			</div>
		<% end %>			
	</div>
</div>